<!-- templates/report/organizational_effectiveness/open-ended.html -->
{% set advanced = report.open_ended.advanced_analysis if report.open_ended and report.open_ended.advanced_analysis else {} %}
<section class="w-full bg-white px-10 py-8 space-y-6" class="report-section">
  <!-- í—¤ë” -->
  <header class="flex items-center justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-400">Open-ended Responses</p>
      <h1 class="text-xl font-semibold text-slate-900 mt-1">
        ì£¼ê´€ì‹ ì‘ë‹µ ë¶„ì„
      </h1>
      <p class="text-sm text-slate-500 mt-1">
        {{ report.organization_name or report.org_name or "ì—…ë¡œë“œ ë°ì´í„°" }}
      </p>
    </div>
    <div class="text-xs text-slate-400">
      Open-Ended
    </div>
  </header>

  <!-- 1. AI ì¢…í•© í•´ì„ ì„¹ì…˜ -->
  {% if report.open_ended.ai_interpretation_summary or report.open_ended.comprehensive_analysis %}
  <section class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-base font-semibold text-slate-900">AI ì¢…í•© í•´ì„</h2>
      <p class="text-[0.6rem] text-slate-400">AI ë¶„ì„</p>
    </div>
    <div class="h-px w-full bg-slate-200"></div>

    <div class="rounded-xl border border-blue-100 bg-gradient-to-br from-blue-50 to-white p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
          <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
          </svg>
        </div>
        <h3 class="text-sm font-semibold text-slate-800">ì¡°ì§ íŠ¹ì„± ì¢…í•© ë¶„ì„</h3>
      </div>

      <div class="text-sm leading-relaxed text-slate-700 space-y-3">
        <div class="whitespace-pre-line">{{ report.open_ended.ai_interpretation_summary or report.open_ended.comprehensive_analysis }}</div>
      </div>
    </div>
  </section>
  {% endif %}

  <!-- 2. ê³ ê¸‰ë¶„ì„ í˜ì´ì§€ 1: ì¸¡ë©´ë³„ ê°ì„±ë¶„ì„ -->
  {% if report.open_ended.advanced_analysis and report.open_ended.advanced_analysis.aspect_sentiment %}
</section>

<!-- í˜ì´ì§€ ë¸Œë ˆì´í¬ -->
<div class="page-break-always"></div>

<section class="w-full bg-white px-10 py-8 space-y-6" class="report-section">
  <!-- í—¤ë” -->
  <header class="flex items-center justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-400">Advanced Analysis</p>
      <h1 class="text-xl font-semibold text-slate-900 mt-1">
        ì¸¡ë©´ë³„ ê°ì„±ë¶„ì„
      </h1>
      <p class="text-sm text-slate-500 mt-1">
        {{ report.organization_name or report.org_name or "ì—…ë¡œë“œ ë°ì´í„°" }}
      </p>
    </div>
    <div class="text-xs text-slate-400">
      {% if report.report_date %}{{ report.report_date }}{% endif %}
    </div>
  </header>

  {% set advanced = report.open_ended.advanced_analysis %}

  <!-- ë¶„ì„ ê°œìš” ì„¤ëª… -->
  <section class="space-y-4">
    <div class="rounded-xl border border-blue-100 bg-gradient-to-br from-blue-50 to-white p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
          <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
        </div>
        <h3 class="text-sm font-semibold text-slate-800">ì¸¡ë©´ë³„ ê°ì„±ë¶„ì„ì´ë€?</h3>
      </div>
      <div class="text-sm leading-relaxed text-slate-700 space-y-2">
        <p>êµ¬ì„±ì›ë“¤ì´ ì‘ì„±í•œ ì£¼ê´€ì‹ ì‘ë‹µì„ <strong>AIê°€ ìë™ìœ¼ë¡œ 5ê°œ ì£¼ì œë³„ë¡œ ë¶„ë¥˜</strong>í•˜ê³ , ê° ì£¼ì œì— ëŒ€í•´ <strong>ê¸ì •ì ì¸ì§€ ë¶€ì •ì ì¸ì§€ ì •ë„ë¥¼ ì ìˆ˜</strong>ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
        <div class="text-xs text-slate-600 space-y-1 mt-3">
          <p><strong>ğŸ“Š ì´ë ‡ê²Œ ë¶„ì„ë©ë‹ˆë‹¤:</strong></p>
          <p>â€¢ <strong>ì¡°ì§ë¬¸í™”</strong>: íšŒì‚¬ ë¶„ìœ„ê¸°, ê°€ì¹˜ê´€, ì¼í•˜ëŠ” ë°©ì‹ì— ëŒ€í•œ ì˜ê²¬ â†’ ì˜ˆ: "ìš°ë¦¬ íšŒì‚¬ëŠ” ììœ ë¡œìš´ ë¶„ìœ„ê¸°", "ìˆ˜ì§ì  ë¬¸í™”ê°€ ì•„ì‰¬ì›€"</p>
          <p>â€¢ <strong>ë¦¬ë”ì‹­</strong>: ìƒì‚¬ë‚˜ ê´€ë¦¬ìì— ëŒ€í•œ ì˜ê²¬ â†’ ì˜ˆ: "íŒ€ì¥ë‹˜ì´ ì†Œí†µì„ ì˜í•´ì£¼ì‹¬", "í”¼ë“œë°±ì´ ë¶€ì¡±í•¨"</p>
          <p>â€¢ <strong>ì—…ë¬´í™˜ê²½</strong>: ì‚¬ë¬´ì‹¤, ì‹œì„¤, ì—…ë¬´ ë„êµ¬ì— ëŒ€í•œ ì˜ê²¬ â†’ ì˜ˆ: "ì‚¬ë¬´ì‹¤ì´ ì¾Œì í•¨", "ì‹œìŠ¤í…œì´ ë¶ˆí¸í•¨"</p>
          <p>â€¢ <strong>ì„±ì¥ê¸°íšŒ</strong>: êµìœ¡, ìŠ¹ì§„, ë°œì „ ê°€ëŠ¥ì„±ì— ëŒ€í•œ ì˜ê²¬ â†’ ì˜ˆ: "ë°°ìš¸ ê¸°íšŒê°€ ë§ìŒ", "ì„±ì¥ì´ ì •ì²´ë¨"</p>
          <p>â€¢ <strong>ì†Œí†µí˜‘ë ¥</strong>: íŒ€ì›Œí¬, ëŒ€í™”, í˜‘ì—…ì— ëŒ€í•œ ì˜ê²¬ â†’ ì˜ˆ: "íŒ€ì›ë“¤ê³¼ ì˜ ì§€ëƒ„", "ì •ë³´ ê³µìœ ê°€ ì•ˆë¨"</p>
        </div>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mt-3">
          <p class="text-xs text-blue-700"><strong>ğŸ’¡ ì‰½ê²Œ ë§í•˜ë©´:</strong> ì—¬ëŸ¬ë¶„ì´ ì“´ ì˜ê²¬ì„ AIê°€ ì½ê³  "ì´ ì˜ê²¬ì€ ì¡°ì§ë¬¸í™”ì— ëŒ€í•œ ë‚´ìš©ì´ê³ , ê¸ì •ì ì´ë„¤/ë¶€ì •ì ì´ë„¤"ë¼ê³  ìë™ìœ¼ë¡œ íŒë‹¨í•´ì„œ ì ìˆ˜ë¥¼ ë§¤ê²¨ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ì¸¡ë©´ë³„ ê°ì„±ë¶„ì„ ê²°ê³¼ -->
  <section class="space-y-6">
    <div class="flex items-center justify-between">
      <h2 class="text-base font-semibold text-slate-900">ì˜ì—­ë³„ ê°ì„± ë¶„ì„</h2>
      <p class="text-[0.6rem] text-slate-400">AI ë¶„ì„</p>
    </div>
    <div class="h-px w-full bg-slate-200"></div>

    <!-- ë¶„ì„ ì„¤ëª… -->
    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
      <div class="flex items-start gap-3">
        <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center mt-0.5">
          <svg class="w-3 h-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div>
          <h3 class="text-sm font-semibold text-blue-900 mb-1">ê°ì„± ì ìˆ˜ ë¶„ì„ ë°©ë²•</h3>
          <p class="text-xs text-blue-700 leading-relaxed">
            êµ¬ì„±ì›ë“¤ì´ ì‘ì„±í•œ ì£¼ê´€ì‹ ì‘ë‹µì„ AIê°€ 5ê°œ ì˜ì—­(ì¡°ì§ë¬¸í™”, ë¦¬ë”ì‹­, ì—…ë¬´í™˜ê²½, ì„±ì¥ê¸°íšŒ, ì†Œí†µí˜‘ë ¥)ìœ¼ë¡œ ìë™ ë¶„ë¥˜í•˜ê³ ,
            ê° ì˜ì—­ë³„ë¡œ ê¸ì •(-1.0~+1.0)ê³¼ ë¶€ì •ì˜ ì •ë„ë¥¼ ìˆ˜ì¹˜í™”í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ê²°ê³¼ëŠ” ì‹¤ì œ ì‘ë‹µ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì‚°ì¶œëœ ì ìˆ˜ì…ë‹ˆë‹¤.
          </p>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for aspect, data in advanced.aspect_sentiment.items() %}
      {% set score = data.average_sentiment | float %}
      {% set positive_count = data.positive_count | default(0) %}
      {% set negative_count = data.negative_count | default(0) %}
      {% set total_count = data.total_responses | default(0) %}

      <!-- ì˜ì—­ë³„ ì•„ì´ì½˜ ì„¤ì • -->
      {% set icon_info = {
        'ì¡°ì§ë¬¸í™”': {'icon': 'ğŸ¢', 'bg': 'from-blue-50 to-blue-100', 'border': 'border-blue-200', 'accent': 'blue'},
        'ë¦¬ë”ì‹­': {'icon': 'ğŸ‘‘', 'bg': 'from-purple-50 to-purple-100', 'border': 'border-purple-200', 'accent': 'purple'},
        'ì—…ë¬´í™˜ê²½': {'icon': 'ğŸ’¼', 'bg': 'from-green-50 to-green-100', 'border': 'border-green-200', 'accent': 'green'},
        'ì„±ì¥ê¸°íšŒ': {'icon': 'ğŸ“ˆ', 'bg': 'from-orange-50 to-orange-100', 'border': 'border-orange-200', 'accent': 'orange'},
        'ì†Œí†µí˜‘ë ¥': {'icon': 'ğŸ¤', 'bg': 'from-teal-50 to-teal-100', 'border': 'border-teal-200', 'accent': 'teal'}
      } %}
      {% set current_icon = icon_info.get(aspect, {'icon': 'ğŸ“Š', 'bg': 'from-slate-50 to-slate-100', 'border': 'border-slate-200', 'accent': 'slate'}) %}

      <div class="rounded-xl border {{ current_icon.border }} bg-gradient-to-br {{ current_icon.bg }} shadow-sm hover:shadow-md transition-all duration-300">
        <!-- í—¤ë” -->
        <div class="p-5 pb-3">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-12 h-12 rounded-xl bg-white shadow-sm flex items-center justify-center text-2xl">
              {{ current_icon.icon }}
            </div>
            <div>
              <h3 class="text-lg font-bold text-slate-900">{{ aspect }}</h3>
              <div class="flex items-center gap-2">
                <span class="text-xs text-slate-600">ì´ {{ total_count }}ê°œ ì‘ë‹µ</span>
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                  {% if score > 0.2 %}bg-emerald-100 text-emerald-700
                  {% elif score < -0.2 %}bg-rose-100 text-rose-700
                  {% else %}bg-slate-100 text-slate-700{% endif %}">
                  {% if score > 0.2 %}ğŸ˜Š ê¸ì •ì 
                  {% elif score < -0.2 %}ğŸ˜Ÿ ë¶€ì •ì 
                  {% else %}ğŸ˜ ì¤‘ë¦½ì {% endif %}
                </span>
              </div>
            </div>
          </div>

          <!-- ê°ì„± ì ìˆ˜ -->
          <div class="bg-white rounded-lg p-3 shadow-sm mb-3">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-medium text-slate-600">ê°ì„± ì ìˆ˜</span>
              <div class="text-xl font-bold
                {% if score > 0.2 %}text-emerald-600
                {% elif score < -0.2 %}text-rose-600
                {% else %}text-slate-600{% endif %}">
                {{ "%.2f"|format(score) }}
              </div>
            </div>
            <!-- ê°ì„± ë°” -->
            <div class="w-full bg-slate-100 rounded-full h-2">
              <div class="h-2 rounded-full transition-all duration-500
                {% if score > 0.2 %}bg-emerald-500
                {% elif score < -0.2 %}bg-rose-500
                {% else %}bg-slate-400{% endif %}"
                style="width: {{ ((score + 1) * 50)|round }}%"></div>
            </div>
            <div class="flex justify-between text-xs text-slate-500 mt-1">
              <span>-1.0</span>
              <span>0</span>
              <span>+1.0</span>
            </div>
          </div>

          <!-- ì‘ë‹µ ë¶„í¬ -->
          <div class="bg-white rounded-lg p-3 shadow-sm">
            <div class="text-xs font-medium text-slate-600 mb-2">ì‘ë‹µ ë¶„í¬</div>
            <div class="flex justify-between items-center text-xs">
              <div class="flex items-center gap-1">
                <div class="w-3 h-3 bg-rose-400 rounded-full"></div>
                <span class="text-slate-600">{{ negative_count }}ê°œ</span>
              </div>
              <div class="flex items-center gap-1">
                <div class="w-3 h-3 bg-slate-300 rounded-full"></div>
                <span class="text-slate-600">{{ total_count - positive_count - negative_count }}ê°œ</span>
              </div>
              <div class="flex items-center gap-1">
                <div class="w-3 h-3 bg-emerald-400 rounded-full"></div>
                <span class="text-slate-600">{{ positive_count }}ê°œ</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ëŒ€í‘œ ì˜ê²¬ -->
        {% if data.representative_responses %}
        <div class="px-5 pb-5">
          <div class="space-y-2">
            {% if data.representative_responses.positive %}
            <div class="bg-white rounded-lg p-3 border-l-4 border-emerald-400 shadow-sm">
              <div class="flex items-start gap-2">
                <div class="w-4 h-4 bg-emerald-500 rounded-full flex items-center justify-center mt-0.5">
                  <span class="text-xs text-white">+</span>
                </div>
                <blockquote class="text-xs text-slate-700 leading-relaxed">
                  "{{ data.representative_responses.positive[:80] }}{% if data.representative_responses.positive|length > 80 %}...{% endif %}"
                </blockquote>
              </div>
            </div>
            {% endif %}

            {% if data.representative_responses.negative %}
            <div class="bg-white rounded-lg p-3 border-l-4 border-rose-400 shadow-sm">
              <div class="flex items-start gap-2">
                <div class="w-4 h-4 bg-rose-500 rounded-full flex items-center justify-center mt-0.5">
                  <span class="text-xs text-white">-</span>
                </div>
                <blockquote class="text-xs text-slate-700 leading-relaxed">
                  "{{ data.representative_responses.negative[:80] }}{% if data.representative_responses.negative|length > 80 %}...{% endif %}"
                </blockquote>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </section>

  <footer class="report-page-footer mt-6">
    <span class="page-number"></span>
  </footer>
</section>

<!-- ê³ ê¸‰ë¶„ì„ í˜ì´ì§€ 2: ê·¼ê±° ê¸°ë°˜ ì œì•ˆ -->
{% if advanced.evidence_suggestions %}
<div style="page-break-before: always;"></div>

<section class="w-full bg-white px-10 py-8 space-y-6" class="report-section">
  <!-- í—¤ë” -->
  <header class="flex items-center justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-400">Advanced Analysis</p>
      <h1 class="text-xl font-semibold text-slate-900 mt-1">
        ê·¼ê±° ê¸°ë°˜ ì œì•ˆ
      </h1>
      <p class="text-sm text-slate-500 mt-1">
        {{ report.organization_name or report.org_name or "ì—…ë¡œë“œ ë°ì´í„°" }}
      </p>
    </div>
    <div class="text-xs text-slate-400">
      {% if report.report_date %}{{ report.report_date }}{% endif %}
    </div>
  </header>

  <!-- ë¶„ì„ ê°œìš” ì„¤ëª… -->
  <section class="space-y-4">
    <div class="rounded-xl border border-orange-100 bg-gradient-to-br from-orange-50 to-white p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center">
          <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
          </svg>
        </div>
        <h3 class="text-sm font-semibold text-slate-800">ê·¼ê±° ê¸°ë°˜ ì œì•ˆì´ë€?</h3>
      </div>
      <div class="text-sm leading-relaxed text-slate-700 space-y-2">
        <p>ì¡°ì§ì˜ <strong>ê°•ì ì€ ë”ìš± í™œìš©í•˜ê³ , ì•½ì ì€ ì²´ê³„ì ìœ¼ë¡œ ê°œì„ </strong>í•  ìˆ˜ ìˆë„ë¡ <strong>ë°ì´í„°ì— ê·¼ê±°í•œ êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ì•ˆ</strong>ì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
        <p class="text-xs text-slate-600">â€¢ ì‹¤ì œ ì‘ë‹µ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ ê°œì„  ë°©ì•ˆ ë„ì¶œ</p>
      </div>
    </div>
  </section>

  <!-- ê·¼ê±° ê¸°ë°˜ ì œì•ˆ ê²°ê³¼ -->
  <section class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-base font-semibold text-slate-900">ì‹¤í–‰ ë°©ì•ˆ ì œì•ˆ</h2>
      <p class="text-[0.6rem] text-slate-400"></p>
    </div>
    <div class="h-px w-full bg-slate-200"></div>

    <div class="space-y-6">
      {% for suggestion in advanced.evidence_suggestions %}
      <div class="rounded-xl border border-slate-100 bg-white p-6 shadow-sm">
        <div class="flex items-center gap-3 mb-4">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 text-sm font-semibold text-blue-700">
            {{ loop.index }}
          </span>
          <div class="flex-1">
            <h4 class="text-sm font-medium text-slate-900">{{ suggestion.title }}</h4>
            <span class="px-2 py-1 text-xs bg-slate-100 text-slate-600 rounded-md mt-1 inline-block">{{ suggestion.type }}</span>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h5 class="text-sm font-medium text-slate-700 mb-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              ê·¼ê±° ì‘ë‹µ
            </h5>
            <div class="space-y-2">
              {% for evidence in suggestion.evidence %}
              <div class="text-xs text-slate-600 bg-slate-50 rounded-lg px-3 py-3 border-l-2 border-green-200">
                "{{ evidence }}"
              </div>
              {% endfor %}
            </div>
          </div>

          <div>
            <h5 class="text-sm font-medium text-slate-700 mb-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
              ì‹¤í–‰ ë°©ì•ˆ
            </h5>
            <ul class="space-y-2">
              {% for action in suggestion.action_items %}
              <li class="text-xs text-slate-600 flex items-start gap-3 bg-blue-50 rounded-lg px-3 py-3">
                <span class="mt-1 h-2 w-2 rounded-full bg-blue-400 flex-shrink-0"></span>
                <span>{{ action }}</span>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <footer class="report-page-footer mt-6">
    <span class="page-number"></span>
  </footer>
</section>
{% endif %}

<!-- ê³ ê¸‰ë¶„ì„ í˜ì´ì§€ 3: íŒ€ë³„ ì ì¬ìœ í˜• ì§€ë„ë¶„ì„ -->
{% if advanced.team_potential_mapping and advanced.team_potential_mapping != {'message': 'íŒ€/ë¶€ì„œ ì •ë³´ê°€ ì—†ì–´ íŒ€ë³„ ë¶„ì„ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'} %}
<div style="page-break-before: always;"></div>

<section class="w-full bg-white px-10 py-8 space-y-6" class="report-section">
  <!-- í—¤ë” -->
  <header class="flex items-center justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-400">Advanced Analysis</p>
      <h1 class="text-xl font-semibold text-slate-900 mt-1">
        íŒ€ë³„ ì ì¬ìœ í˜• ì§€ë„ë¶„ì„
      </h1>
      <p class="text-sm text-slate-500 mt-1">
        {{ report.organization_name or report.org_name or "ì—…ë¡œë“œ ë°ì´í„°" }}
      </p>
    </div>
    <div class="text-xs text-slate-400">
      {% if report.report_date %}{{ report.report_date }}{% endif %}
    </div>
  </header>

  <!-- ë¶„ì„ ê°œìš” ì„¤ëª… -->
  <section class="space-y-4">
    <div class="rounded-xl border border-purple-100 bg-gradient-to-br from-purple-50 to-white p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
          <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
          </svg>
        </div>
        <h3 class="text-sm font-semibold text-slate-800">íŒ€ë³„ ì ì¬ìœ í˜• ì§€ë„ë¶„ì„ì´ë€?</h3>
      </div>
      <div class="text-sm leading-relaxed text-slate-700 space-y-3">
        <p><strong>ê° íŒ€/ë¶€ì„œì˜ ê³ ìœ í•œ íŠ¹ì„±ê³¼ ì ì¬ë ¥</strong>ì„ ì‹œê°ì ìœ¼ë¡œ ë§¤í•‘í•˜ì—¬, <strong>ë§ì¶¤í˜• ì¡°ì§ ê°œë°œ ì „ëµ</strong> ìˆ˜ë¦½ì„ ì§€ì›í•©ë‹ˆë‹¤.</p>

        <!-- ë¶„ì„ ì¡°ê±´ ì•ˆë‚´ -->
        <p class="text-xs text-slate-400 mt-4">íŒ€ë³„ ë¶„ì„ì€ ê° íŒ€ë‹¹ ìµœì†Œ 3ëª… ì´ìƒì˜ ì‘ë‹µìê°€ ìˆì–´ì•¼ ì •í™•í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¸ì›ìˆ˜ê°€ ë¶€ì¡±í•œ íŒ€ì€ ë¶„ì„ ê²°ê³¼ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</p>
      </div>
    </div>
  </section>

  <!-- 4ê°€ì§€ íŒ€ ìœ í˜•ë³„ ì„¤ëª… -->
  <section class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-base font-semibold text-slate-900">4ê°€ì§€ íŒ€ ìœ í˜•ë³„ íŠ¹ì§•</h2>
      <p class="text-[0.6rem] text-slate-400">Guide</p>
    </div>
    <div class="h-px w-full bg-slate-200"></div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <!-- ì°½ì¡°í˜ì‹ í˜• -->
      <div class="rounded-lg border border-blue-100 bg-gradient-to-br from-blue-50 to-white p-3 shadow-sm">
        <div class="flex items-center gap-2 mb-2">
          <div class="text-lg">ğŸš€</div>
          <div>
            <h3 class="text-sm font-semibold text-blue-800">ì°½ì¡°í˜ì‹ í˜•</h3>
            <p class="text-xs text-blue-600">(Creative & Innovative)</p>
          </div>
        </div>
        <p class="text-xs text-slate-700 mb-2">ìƒˆë¡œìš´ ì•„ì´ë””ì–´ ì°½ì¶œê³¼ í˜ì‹ ì— ê°•ì ì„ ë³´ì´ëŠ” íŒ€</p>
        <div class="space-y-1 text-xs">
          <div>
            <span class="font-medium text-slate-700">íŠ¹ì§•:</span>
            <span class="text-slate-600">ì°½ì˜ì  ì‚¬ê³ , ë„ì „ì •ì‹ , ë³€í™” ì ì‘ë ¥, ì‹¤í—˜ì  ì ‘ê·¼</span>
          </div>
          <div>
            <span class="font-medium text-slate-700">í™œìš©ë²•:</span>
            <span class="text-slate-600">ì‹ ì œí’ˆ ê°œë°œ, í”„ë¡œì„¸ìŠ¤ í˜ì‹ , ë¯¸ë˜ ì „ëµ ìˆ˜ë¦½ í”„ë¡œì íŠ¸ì— íˆ¬ì…</span>
          </div>
        </div>
      </div>

      <!-- ì²´ê³„ì•ˆì •í˜• -->
      <div class="rounded-lg border border-green-100 bg-gradient-to-br from-green-50 to-white p-3 shadow-sm">
        <div class="flex items-center gap-2 mb-2">
          <div class="text-lg">âš–ï¸</div>
          <div>
            <h3 class="text-sm font-semibold text-green-800">ì²´ê³„ì•ˆì •í˜•</h3>
            <p class="text-xs text-green-600">(Systematic & Stable)</p>
          </div>
        </div>
        <p class="text-xs text-slate-700 mb-2">ì²´ê³„ì ì´ê³  ì•ˆì •ì ì¸ ì—…ë¬´ ìˆ˜í–‰ì— ê°•ì ì„ ë³´ì´ëŠ” íŒ€</p>
        <div class="space-y-1 text-xs">
          <div>
            <span class="font-medium text-slate-700">íŠ¹ì§•:</span>
            <span class="text-slate-600">ëª…í™•í•œ í”„ë¡œì„¸ìŠ¤ ì„ í˜¸, ì •í™•ì„±, ì•ˆì •ì„± ì¤‘ì‹œ, ê³„íšì  ì‹¤í–‰</span>
          </div>
          <div>
            <span class="font-medium text-slate-700">í™œìš©ë²•:</span>
            <span class="text-slate-600">í’ˆì§ˆê´€ë¦¬, ë¦¬ìŠ¤í¬ ê´€ë¦¬, ê·œì • ì¤€ìˆ˜, ìš´ì˜ ìµœì í™” ì—…ë¬´ì— íˆ¬ì…</span>
          </div>
        </div>
      </div>

      <!-- ì†Œí†µí˜‘ë ¥í˜• -->
      <div class="rounded-lg border border-purple-100 bg-gradient-to-br from-purple-50 to-white p-3 shadow-sm">
        <div class="flex items-center gap-2 mb-2">
          <div class="text-lg">ğŸ¤</div>
          <div>
            <h3 class="text-sm font-semibold text-purple-800">ì†Œí†µí˜‘ë ¥í˜•</h3>
            <p class="text-xs text-purple-600">(Collaborative & Communicative)</p>
          </div>
        </div>
        <p class="text-xs text-slate-700 mb-2">íŒ€ì›Œí¬ì™€ í˜‘ë ¥ì„ í†µí•œ ì‹œë„ˆì§€ ì°½ì¶œì— ê°•ì ì„ ë³´ì´ëŠ” íŒ€</p>
        <div class="space-y-1 text-xs">
          <div>
            <span class="font-medium text-slate-700">íŠ¹ì§•:</span>
            <span class="text-slate-600">ì›í™œí•œ ì†Œí†µ, ìƒí˜¸ ì§€ì›, ê°ˆë“± ì¡°ì • ëŠ¥ë ¥, í¬ìš©ì  ë¶„ìœ„ê¸°</span>
          </div>
          <div>
            <span class="font-medium text-slate-700">í™œìš©ë²•:</span>
            <span class="text-slate-600">í¬ë¡œìŠ¤ íŒ€ í”„ë¡œì íŠ¸, ê³ ê° ì„œë¹„ìŠ¤, ì¡°ì§ ë¬¸í™” ê°œì„ ì— íˆ¬ì…</span>
          </div>
        </div>
      </div>

      <!-- ëª©í‘œë‹¬ì„±í˜• -->
      <div class="rounded-lg border border-orange-100 bg-gradient-to-br from-orange-50 to-white p-3 shadow-sm">
        <div class="flex items-center gap-2 mb-2">
          <div class="text-lg">ğŸ¯</div>
          <div>
            <h3 class="text-sm font-semibold text-orange-800">ëª©í‘œë‹¬ì„±í˜•</h3>
            <p class="text-xs text-orange-600">(Goal-Oriented & Achievement-Focused)</p>
          </div>
        </div>
        <p class="text-xs text-slate-700 mb-2">ëª…í™•í•œ ëª©í‘œ ì„¤ì •ê³¼ ê°•ë ¥í•œ ì‹¤í–‰ë ¥ìœ¼ë¡œ ì„±ê³¼ë¥¼ ë‹¬ì„±í•˜ëŠ” íŒ€</p>
        <div class="space-y-1 text-xs">
          <div>
            <span class="font-medium text-slate-700">íŠ¹ì§•:</span>
            <span class="text-slate-600">ì„±ê³¼ ì§€í–¥, ë¹ ë¥¸ ì˜ì‚¬ê²°ì •, ê°•í•œ ì‹¤í–‰ë ¥, ê²½ìŸ ë™ê¸°</span>
          </div>
          <div>
            <span class="font-medium text-slate-700">í™œìš©ë²•:</span>
            <span class="text-slate-600">ë§¤ì¶œ ëª©í‘œ ë‹¬ì„±, ê¸´ê¸‰ í”„ë¡œì íŠ¸, í„°ë‹ì–´ë¼ìš´ë“œ ìƒí™©ì— íˆ¬ì…</span>
          </div>
        </div>
      </div>
    </div>
    </div>
  </section>

  <!-- íŒ€ë³„ ì ì¬ìœ í˜• ë¶„ì„ ê²°ê³¼ -->
  {% set has_teams = false %}
  {% for team_name, analysis in advanced.team_potential_mapping.items() %}
    {% if team_name != 'message' and (analysis.size is not defined or analysis.size >= 1) %}
      {% set has_teams = true %}
    {% endif %}
  {% endfor %}

  {% if has_teams %}
  <section class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-base font-semibold text-slate-900">íŒ€ë³„ ì ì¬ìœ í˜• ë§¤í•‘</h2>
      <p class="text-[0.6rem] text-slate-400">Team Analysis</p>
    </div>
    <div class="h-px w-full bg-slate-200"></div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for team_name, analysis in advanced.team_potential_mapping.items() %}
      {% if team_name != 'message' and (analysis.size is not defined or analysis.size >= 1) %}
      <div class="rounded-xl border border-slate-100 bg-white p-6 shadow-sm">
        <div class="flex items-center justify-between mb-4">
          <h4 class="text-sm font-medium text-slate-900">{{ team_name }}</h4>
          <span class="text-xs text-slate-500 bg-slate-100 rounded-full px-2 py-1">{{ analysis.size }}ëª…</span>
        </div>

        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <span class="text-sm text-slate-600">ì ì¬ìœ í˜•</span>
            <span class="px-3 py-1 text-sm rounded-full font-medium
              {% if 'í˜ì‹ ' in analysis.potential_type %}bg-green-100 text-green-700
              {% elif 'ì„±ì¥' in analysis.potential_type %}bg-blue-100 text-blue-700
              {% elif 'ì•ˆì •' in analysis.potential_type %}bg-yellow-100 text-yellow-700
              {% else %}bg-red-100 text-red-700{% endif %}">
              {{ analysis.potential_type }}
            </span>
          </div>

          <div class="text-sm text-slate-600 bg-slate-50 rounded-lg px-4 py-3">
            <span class="font-medium text-slate-700">ì£¼ìš”íŠ¹ì„±:</span><br>
            {{ analysis.dominant_trait }}
          </div>

          <div>
            <h5 class="text-sm font-medium text-slate-700 mb-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
              </svg>
              ë°œì „ ë°©í–¥
            </h5>
            <ul class="space-y-2">
              {% for suggestion in analysis.development_suggestions %}
              <li class="text-xs text-slate-600 flex items-start gap-3 bg-purple-50 rounded-lg px-3 py-2">
                <span class="mt-1 h-2 w-2 rounded-full bg-purple-400 flex-shrink-0"></span>
                <span>{{ suggestion }}</span>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <footer class="report-page-footer mt-6">
    <span class="page-number"></span>
  </footer>
</section>
{% endif %}
{% endif %}

<!-- ì£¼ê´€ì‹ ì‘ë‹µ ì„¹ì…˜ -->
<div style="page-break-before: always;"></div>

<section class="w-full bg-white px-10 py-8 space-y-6" class="report-section">
  <!-- í—¤ë” -->
  <header class="flex items-center justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-wide text-slate-400">Detailed Responses</p>
      <h1 class="text-xl font-semibold text-slate-900 mt-1">
        ì£¼ê´€ì‹ ì‘ë‹µ ìƒì„¸
      </h1>
      <p class="text-sm text-slate-500 mt-1">
        {{ report.organization_name or report.org_name or "ì—…ë¡œë“œ ë°ì´í„°" }}
      </p>
    </div>
    <div class="text-xs text-slate-400">
      {% if report.report_date %}{{ report.report_date }}{% endif %}
    </div>
  </header>

  <!-- 3. ì¹´í…Œê³ ë¦¬ë³„ ì£¼ê´€ì‹ ì‘ë‹µ í‘œì‹œ -->
  {% set responses = report.open_ended.basic_responses if report.open_ended.basic_responses else report.open_ended %}
  {# Sort responses by content length (longest first) #}
  {% set responses_with_lengths = [] %}
  {% for block in responses %}
    {% set total_length = 0 %}
    {% for answer in block.answers %}
      {% set total_length = total_length + (answer|length) %}
    {% endfor %}
    {% set _ = block.update({'total_answer_length': total_length}) %}
    {% set _ = responses_with_lengths.append(block) %}
  {% endfor %}
  {% set sorted_responses = responses_with_lengths | sort(attribute='total_answer_length', reverse=true) %}
  {% set current_category = "" %}
  {% set page_break_needed = false %}

  {% for block in sorted_responses %}
    {% if block.category != current_category %}
      {% set current_category = block.category %}

      <!-- í˜ì´ì§€ ë¸Œë ˆì´í¬ê°€ í•„ìš”í•œ ê²½ìš° -->
      {% if page_break_needed %}
        </section>
        <div style="page-break-before: always;"></div>
        <section class="w-full bg-white px-10 py-8 space-y-6" class="report-section">
      {% endif %}

      <!-- ì¹´í…Œê³ ë¦¬ í—¤ë” -->
      <section class="space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-base font-semibold text-slate-900">
            {{ current_category }}
          </h2>
        </div>
        <div class="h-px w-full bg-slate-200"></div>
        {% set page_break_needed = true %}
    {% endif %}

    <!-- ê°œë³„ ë¬¸í•­ ì‘ë‹µ -->
    <div class="space-y-3">
      <h3 class="text-sm font-medium text-slate-700 flex items-center gap-2">
        <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-100 text-[10px] font-semibold text-slate-600">
          {{ block.header }}
        </span>
        {{ block.title }}
      </h3>

      <div class="space-y-2">
        {% for ans in block.answers %}
        <div class="rounded-xl border border-slate-100 bg-slate-50 px-4 py-3" style="page-break-inside: avoid; break-inside: avoid;">
          <p class="text-sm text-slate-700 leading-relaxed">
            {{ ans }}
          </p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ ë‹«ê¸° ì²˜ë¦¬ -->
    {% if loop.last or (loop.nextitem and loop.nextitem.category != current_category) %}
      </section>
    {% endif %}
  {% endfor %}

  <footer class="report-page-footer mt-6">
    <span class="page-number"></span>
  </footer>
</section>
